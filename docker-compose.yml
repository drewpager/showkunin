version: '3.8'

services:
  # Agent Runtime Service
  # Polls database for pending runs and executes via Claude Agent SDK
  agent-runtime:
    build:
      context: ./agent-runtime
      dockerfile: Dockerfile
    environment:
      DATABASE_URL: ${DATABASE_URL}
      ENCRYPTION_KEY: ${ENCRYPTION_KEY}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      AWS_BUCKET_NAME: ${AWS_BUCKET_NAME}
      AWS_KEY_ID: ${AWS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      AWS_REGION: ${AWS_REGION}
    volumes:
      - agent-workspace:/app/workspace
    restart: unless-stopped
    # Uncomment to enable log viewing
    # logging:
    #   driver: "json-file"
    #   options:
    #     max-size: "10m"
    #     max-file: "3"

volumes:
  agent-workspace:
    driver: local
